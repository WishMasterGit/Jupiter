<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package
    Name="Jupiter"
    Manufacturer="WishMasterGit"
    Version="$(var.Version)"
    UpgradeCode="A1B2C3D4-E5F6-7890-ABCD-EF1234567890"
    Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="A newer version of Jupiter is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <Feature Id="ProductFeature" Title="Jupiter" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="ShortcutComponents" />
      <ComponentGroupRef Id="PathComponents" />
    </Feature>
  </Package>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="Jupiter" />
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Jupiter" />
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="JupiterCLI" Guid="B2C3D4E5-F6A7-8901-BCDE-F12345678901">
        <File Id="JupiterExe" Source="$(var.SourceDir)\jupiter.exe" KeyPath="yes" />
      </Component>
      <Component Id="JupiterGUI" Guid="C3D4E5F6-A7B8-9012-CDEF-123456789012">
        <File Id="JupiterGuiExe" Source="$(var.SourceDir)\jupiter-gui.exe" KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="ShortcutComponents" Directory="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="D4E5F6A7-B8C9-0123-DEF0-234567890123">
        <Shortcut
          Id="ApplicationStartMenuShortcut"
          Name="Jupiter GUI"
          Description="Planetary image processing"
          Target="[INSTALLFOLDER]jupiter-gui.exe"
          WorkingDirectory="INSTALLFOLDER" />
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue
          Root="HKCU"
          Key="Software\WishMasterGit\Jupiter"
          Name="installed"
          Type="integer"
          Value="1"
          KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <ComponentGroup Id="PathComponents" Directory="INSTALLFOLDER">
      <Component Id="PathEntry" Guid="E5F6A7B8-C9D0-1234-EF01-345678901234">
        <Environment
          Id="PATH"
          Name="PATH"
          Value="[INSTALLFOLDER]"
          Permanent="no"
          Part="last"
          Action="set"
          System="yes" />
        <RegistryValue
          Root="HKCU"
          Key="Software\WishMasterGit\Jupiter"
          Name="path"
          Type="integer"
          Value="1"
          KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
